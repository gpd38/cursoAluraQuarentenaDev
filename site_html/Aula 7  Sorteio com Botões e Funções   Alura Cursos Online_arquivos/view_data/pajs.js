(function(n){"use strict";var i=!1,u=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,r=function(){},t;r.extend=function(n){function f(){!i&&this.init&&this.init.apply(this,arguments)}var o=this.prototype,e,t;i=!0;e=new this;i=!1;for(t in n)e[t]=typeof n[t]=="function"&&typeof o[t]=="function"&&u.test(n[t])?function(n,t){return function(){var r=this._super,i;return this._super=o[n],i=t.apply(this,arguments),this._super=r,i}}(t,n[t]):n[t];return f.prototype=e,f.prototype.constructor=f,f.extend=r.extend,f};t={debug:!1,trace:function(t){this.debug&&n.console!==undefined&&n.console.log("Porthole: "+t)},error:function(t){typeof n.console!==undefined&&typeof n.console.error=="function"&&n.console.error("Porthole: "+t)}};t.WindowProxy=function(){};t.WindowProxy.prototype={post:function(){},addEventListener:function(){},removeEventListener:function(){}};t.WindowProxyBase=r.extend({init:function(t){t===undefined&&(t="");this.targetWindowName=t;this.origin=n.location.protocol+"//"+n.location.host;this.eventListeners=[]},getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},getTargetWindow:function(){return t.WindowProxy.getTargetWindow(this.targetWindowName)},post:function(t,i){i===undefined&&(i="*");this.dispatchMessage({data:t,sourceOrigin:this.getOrigin(),targetOrigin:i,sourceWindowName:n.name,targetWindowName:this.getTargetWindowName()})},addEventListener:function(n){return this.eventListeners.push(n),n},removeEventListener:function(n){var t;try{t=this.eventListeners.indexOf(n);this.eventListeners.splice(t,1)}catch(i){this.eventListeners=[]}},dispatchEvent:function(n){for(var i=0;i<this.eventListeners.length;i++)try{this.eventListeners[i](n)}catch(r){t.error(r)}}});t.WindowProxyLegacy=t.WindowProxyBase.extend({init:function(n,i){this._super(i);n!==null?(this.proxyIFrameName=this.targetWindowName+"ProxyIFrame",this.proxyIFrameLocation=n,this.proxyIFrameElement=this.createIFrameProxy()):(this.proxyIFrameElement=null,t.trace("proxyIFrameUrl is null, window will be a receiver only"),this.post=function(){throw new Error("Receiver only window");})},createIFrameProxy:function(){var n=document.createElement("iframe");return n.setAttribute("id",this.proxyIFrameName),n.setAttribute("name",this.proxyIFrameName),n.setAttribute("src",this.proxyIFrameLocation),n.setAttribute("frameBorder","1"),n.setAttribute("scrolling","auto"),n.setAttribute("width",30),n.setAttribute("height",30),n.setAttribute("style","position: absolute; left: -100px; top:0px;"),n.style.setAttribute&&n.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;"),document.body.appendChild(n),n},dispatchMessage:function(i){var u=n.encodeURIComponent,r;this.proxyIFrameElement&&(r=this.proxyIFrameLocation+"#"+u(t.WindowProxy.serialize(i)),this.proxyIFrameElement.setAttribute("src",r),this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100)}});t.WindowProxyHTML5=t.WindowProxyBase.extend({init:function(n,t){this._super(t);this.eventListenerCallback=null},dispatchMessage:function(n){this.getTargetWindow().postMessage(t.WindowProxy.serialize(n),n.targetOrigin)},addEventListener:function(t){if(this.eventListeners.length===0){var i=this;n.addEventListener?(this.eventListenerCallback=function(n){i.eventListener(i,n)},n.addEventListener("message",this.eventListenerCallback,!1)):n.attachEvent&&(this.eventListenerCallback=function(){i.eventListener(i,n.event)},n.attachEvent("onmessage",this.eventListenerCallback))}return this._super(t)},removeEventListener:function(t){this._super(t);this.eventListeners.length===0&&(n.removeEventListener?n.removeEventListener("message",this.eventListenerCallback):n.detachEvent&&(typeof n.onmessage=="undefined"&&(n.onmessage=null),n.detachEvent("onmessage",this.eventListenerCallback)),this.eventListenerCallback=null)},eventListener:function(n,i){var r=t.WindowProxy.unserialize(i.data);r&&(n.targetWindowName===""||r.sourceWindowName==n.targetWindowName)&&n.dispatchEvent(new t.MessageEvent(r.data,i.origin,n))}});n.postMessage?(t.trace("Using built-in browser support"),t.WindowProxy=t.WindowProxyHTML5.extend({})):(t.trace("Using legacy browser support"),t.WindowProxy=t.WindowProxyLegacy.extend({}));t.WindowProxy.serialize=function(n){if(typeof JSON=="undefined")throw new Error("Porthole serialization depends on JSON!");return JSON.stringify(n)};t.WindowProxy.unserialize=function(n){if(typeof JSON=="undefined")throw new Error("Porthole unserialization dependens on JSON!");try{var t=JSON.parse(n)}catch(i){return!1}return t};t.WindowProxy.getTargetWindow=function(t){return t===""?parent:t==="top"||t==="parent"?n[t]:n.frames[t]};t.MessageEvent=function(n,t,i){this.data=n;this.origin=t;this.source=i};t.WindowProxyDispatcher={forwardMessageEvent:function(){var i,f=n.decodeURIComponent,u,r;document.location.hash.length>0&&(i=t.WindowProxy.unserialize(f(document.location.hash.substr(1))),u=t.WindowProxy.getTargetWindow(i.targetWindowName),r=t.WindowProxyDispatcher.findWindowProxyObjectInWindow(u,i.sourceWindowName),r?r.origin===i.targetOrigin||i.targetOrigin==="*"?r.dispatchEvent(new t.MessageEvent(i.data,i.sourceOrigin,r)):t.error("Target origin "+r.origin+" does not match desired target of "+i.targetOrigin):t.error("Could not find window proxy object on the target window"))},findWindowProxyObjectInWindow:function(n,t){var i;if(n)for(i in n)if(Object.prototype.hasOwnProperty.call(n,i))try{if(n[i]!==null&&typeof n[i]=="object"&&n[i]instanceof n.Porthole.WindowProxy&&n[i].getTargetWindowName()===t)return n[i]}catch(r){}return null},start:function(){n.addEventListener?n.addEventListener("resize",t.WindowProxyDispatcher.forwardMessageEvent,!1):n.attachEvent&&n.postMessage!=="undefined"?n.attachEvent("onresize",t.WindowProxyDispatcher.forwardMessageEvent):document.body.attachEvent?n.attachEvent("onresize",t.WindowProxyDispatcher.forwardMessageEvent):t.error("Cannot attach resize event")}};typeof exports!="undefined"?module.exports=t:n.Porthole=t})(typeof window!="undefined"?window:this);
//# sourceMappingURL=pajs.min.js.map
